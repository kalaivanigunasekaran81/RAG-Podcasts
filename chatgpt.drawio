<mxfile>
  <diagram name="RAG Podcast Architecture">
    <mxGraphModel>
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- INDEXING PIPELINE -->

        <mxCell id="idxTitle" value="INDEXING PIPELINE"
          style="rounded=1;fillColor=#dae8fc;html=1;"
          vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="620" height="40" as="geometry"/>
        </mxCell>

        <mxCell id="transcripts" value="Podcast Transcripts"
          style="shape=database;html=1;"
          vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="140" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="chunking" value="Chunking"
          style="rounded=1;html=1;"
          vertex="1" parent="1">
          <mxGeometry x="220" y="80" width="130" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="entity" value="Metadata Extraction"
          style="rounded=1;html=1;"
          vertex="1" parent="1">
          <mxGeometry x="220" y="160" width="200" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="docEmbed" value="Document Embeddings (Sentence Transformers)"
          style="rounded=1;html=1;fillColor=#e1f5fe;"
          vertex="1" parent="1">
          <mxGeometry x="460" y="110" width="200" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="opensearch" value="OpenSearch Index (BM25 and HNSW)"
          style="rounded=1;html=1;fillColor=#fce4ec;"
          vertex="1" parent="1">
          <mxGeometry x="460" y="210" width="240" height="70" as="geometry"/>
        </mxCell>


        <!-- QUERY PIPELINE -->

        <mxCell id="qryTitle" value="QUERY PIPELINE"
          style="rounded=1;fillColor=#d5e8d4;html=1;"
          vertex="1" parent="1">
          <mxGeometry x="20" y="330" width="900" height="40" as="geometry"/>
        </mxCell>

        <mxCell id="user" value="User"
          style="ellipse;html=1;"
          vertex="1" parent="1">
          <mxGeometry x="40" y="390" width="80" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="webapp" value="Web App (Flask API)"
          style="rounded=1;html=1;"
          vertex="1" parent="1">
          <mxGeometry x="160" y="385" width="180" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="qryEmbed" value="Query Embeddings"
          style="rounded=1;html=1;fillColor=#e1f5fe;"
          vertex="1" parent="1">
          <mxGeometry x="380" y="385" width="170" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="search" value="Hybrid Search (BM25 and kNN)"
          style="rounded=1;html=1;fillColor=#fce4ec;"
          vertex="1" parent="1">
          <mxGeometry x="590" y="385" width="200" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="topk" value="Top K Chunks"
          style="rounded=1;html=1;"
          vertex="1" parent="1">
          <mxGeometry x="820" y="385" width="140" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="prompt" value="Prompt Builder"
          style="rounded=1;html=1;fillColor=#fff9c4;"
          vertex="1" parent="1">
          <mxGeometry x="820" y="470" width="140" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="llm" value="LLM (Ollama)"
          style="rounded=1;html=1;fillColor=#c8e6c9;"
          vertex="1" parent="1">
          <mxGeometry x="1020" y="430" width="150" height="60" as="geometry"/>
        </mxCell>

        <!-- EDGES -->

        <mxCell id="e1" style="endArrow=block;" edge="1" parent="1" source="transcripts" target="chunking"/>
        <mxCell id="e2" style="endArrow=block;" edge="1" parent="1" source="chunking" target="entity"/>
        <mxCell id="e3" style="endArrow=block;" edge="1" parent="1" source="entity" target="docEmbed"/>
        <mxCell id="e4" style="endArrow=block;" edge="1" parent="1" source="docEmbed" target="opensearch"/>

        <mxCell id="e5" style="endArrow=block;" edge="1" parent="1" source="user" target="webapp"/>
        <mxCell id="e6" style="endArrow=block;" edge="1" parent="1" source="webapp" target="qryEmbed"/>
        <mxCell id="e7" style="endArrow=block;" edge="1" parent="1" source="qryEmbed" target="search"/>
        <mxCell id="e8" style="endArrow=block;" edge="1" parent="1" source="search" target="topk"/>
        <mxCell id="e9" style="endArrow=block;" edge="1" parent="1" source="opensearch" target="search"/>
        <mxCell id="e10" style="endArrow=block;" edge="1" parent="1" source="topk" target="prompt"/>
        <mxCell id="e11" style="endArrow=block;" edge="1" parent="1" source="prompt" target="llm"/>
        <mxCell id="e12" value="Answer" style="endArrow=block;dashed=1;" edge="1" parent="1" source="llm" target="webapp"/>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
